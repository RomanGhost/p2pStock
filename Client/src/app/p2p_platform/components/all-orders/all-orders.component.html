<div class="container orders-container mt-5">
  <h1 class="text-center mb-4">üìã –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤</h1>

  <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
  <div *ngIf="isLoading" class="text-center">
    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</p>
  </div>

  <!-- –û—à–∏–±–∫–∞ -->
  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <!-- –§–∏–ª—å—Ç—Ä—ã -->
  <div class="filters-section mb-4">
    <form [formGroup]="filterForm" (ngSubmit)="filterOrders()" class="filters-row d-flex justify-content-between align-items-center flex-wrap">
      <div class="filter-item">
        <label for="typeFilter" class="form-label">–¢–∏–ø</label>
        <select id="typeFilter" formControlName="type" (change)="filterOrders()" class="form-select">
          <option value="">–í—Å–µ</option>
          <option *ngFor="let type of uniqueOrderTypes" [value]="type.name">{{ type.name }}</option>
        </select>
      </div>
      <div class="filter-item">
        <label for="cryptoFilter" class="form-label">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</label>
        <select id="cryptoFilter" formControlName="cryptoCode" (change)="filterOrders()" class="form-select">
          <option value="">–í—Å–µ</option>
          <option *ngFor="let crypto of uniqueCryptocurrencies" [value]="crypto.code">{{ crypto.name }}</option>
        </select>
      </div>
      <div class="filter-item">
        <label for="sortOrder" class="form-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
        <select id="sortOrder" formControlName="sortOrder" (change)="filterOrders()" class="form-select">
          <option value="desc">–ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
          <option value="asc">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
        </select>
      </div>
      <div class="filter-item">
        <label class="form-label">&nbsp;</label>
        <button type="button" (click)="resetFilters()" class="btn btn-primary btn-outline-secondary w-100">–°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
    </form>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
  <section class="cards-section" *ngIf="!isLoading && !errorMessage">
    <div class="cards-grid">
      <div *ngFor="let order of filteredOrders" class="card-item" (click)="openCreateDealModal(order)">
        <div class="card-header d-flex justify-content-between align-items-center mb-2">
          <h4>–ó–∞–∫–∞–∑ #{{ order.id }}</h4>
          <span class="badge" [ngClass]="{
              'bg-success': order.typeName === '–ü–æ–∫—É–ø–∫–∞',
              'bg-danger': order.typeName === '–ü—Ä–æ–¥–∞–∂–∞'
            }">
            {{ order.typeName }}
          </span>
        </div>

        <p class="text-muted mb-1">–°–æ–∑–¥–∞–Ω–æ: {{ order.createdAt | date: 'dd.MM.yyyy HH:mm' }}</p>

        <div class="mb-2">
          <strong>–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞:</strong> {{ order.cryptocurrencyCode }} |
          <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> {{ order.userLogin }}
        </div>

        <div class="order-financials mb-2">
          <div><strong>–¶–µ–Ω–∞:</strong> {{ order.unitPrice | number: '1.2-2' }}</div>
          <div><strong>–ö–æ–ª-–≤–æ:</strong> {{ order.quantity }}</div>
        </div>

        <div class="total">
          <strong>–ò—Ç–æ–≥:</strong> <span class="total-price">{{ order.unitPrice * order.quantity | number: '1.2-2' }}</span>
        </div>

        <div *ngIf="order.description" class="text-muted mt-2">
          <em>–û–ø–∏—Å–∞–Ω–∏–µ: {{ order.description }}</em>
        </div>
      </div>
    </div>
  </section>

  <!-- –ú–æ–¥–∞–ª–∫–∞ -->
  <app-create-deal *ngIf="isCreateDealModalOpen" [selectedOrder]="selectedOrder" (closeModalEvent)="closeCreateDealModal()"></app-create-deal>

  <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
  <div *ngIf="totalPages > 1" class="pagination-section text-center">
    <button *ngIf="showBackButton()" (click)="onPageChange(page - 1)" class="btn btn-outline-primary me-2">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
    <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page + 1 }} –∏–∑ {{ totalPages }}</span>
    <button *ngIf="showForwardButton()" (click)="onPageChange(page + 1)" class="btn btn-outline-primary ms-2">–í–ø–µ—Ä–µ–¥ ‚û°Ô∏è</button>
  </div>

  <!-- –í—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ -->
  <div class="pagination-options mt-3 text-center">
    <label for="sizeFilter">–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:</label>
    <select id="sizeFilter" (change)="onSizeChange($event)" class="form-select d-inline-block w-auto ms-2">
      <option *ngFor="let size of availablePageSizes" [value]="size">{{ size }}</option>
    </select>
  </div>
</div>
