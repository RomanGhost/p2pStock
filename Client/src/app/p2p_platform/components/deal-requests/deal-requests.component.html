<div class="requests-container">
  <h2>üìÑ –°–¥–µ–ª–∫–∏</h2>

  <!-- –§–∏–ª—å—Ç—Ä—ã -->
  <div class="filters">
    <label>
      –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ:
      <input type="date" [(ngModel)]="filters.changedAfter" (change)="applyFilters()" />
    </label>

    <label>
      –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:
      <select [(ngModel)]="filters.sortOrder" (change)="applyFilters()">
        <option value="asc">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
        <option value="desc">–ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
      </select>
    </label>
  </div>

  <div *ngIf="isLoading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

  <div *ngIf="!isLoading && deals.length > 0; else noDeals">
    <ul class="deal-list">
      <li *ngFor="let deal of deals" class="deal-item">
        <div class="deal-details">
          <h3>üìå –°–¥–µ–ª–∫–∞ #{{ deal.id }}</h3>
          <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ deal.statusName }}</p>
          <p><strong>–°–æ–∑–¥–∞–Ω–æ:</strong> {{ deal.createdAt | date: 'dd.MM.yyyy HH:mm' }}</p>
          <p><strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong> {{ deal.lastStatusChange | date: 'dd.MM.yyyy HH:mm' }}</p>

          <!-- –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ -->
          <div class="deal-info-box">
            <p><strong>–¢–∏–ø:</strong> {{ deal.buyOrder.typeName === 'Buy' ? '–ü–æ–∫—É–ø–∫–∞' : '–ü—Ä–æ–¥–∞–∂–∞' }}</p>
            <p><strong>–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞:</strong> {{ deal.buyOrder.cryptocurrencyCode }}</p>
            <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</strong> {{ deal.buyOrder.quantity }}</p>
            <p><strong>–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É:</strong> {{ deal.buyOrder.unitPrice | number:'1.2-2' }} ‚ÇΩ</p>
            <p><strong>–û–±—â–∞—è —Å—É–º–º–∞:</strong> {{ deal.buyOrder.quantity * deal.buyOrder.unitPrice | number:'1.2-2' }} ‚ÇΩ</p>
          </div>
        </div>

        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
        <div class="deal-actions">
          <button 
            *ngIf="isAssociatedWithDeal(deal) && deal.statusName === '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏' && wasCreatedEarlier(deal)"
            (click)="confirmDeal(deal.id)" class="btn confirm">
            ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–¥–µ–ª–∫—É
          </button>

          <button 
            *ngIf="isAssociatedWithDeal(deal) && deal.statusName === '–û–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞' && deal.buyOrder.userLogin === user?.login"
            (click)="confirmDeal(deal.id)" class="btn confirm">
            ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥
          </button>

          <button 
            *ngIf="isAssociatedWithDeal(deal) && deal.statusName === '–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞' && deal.sellOrder.userLogin === user?.login"
            (click)="confirmDeal(deal.id)" class="btn confirm">
            ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ
          </button>

          <button 
            *ngIf="isAssociatedWithDeal(deal) && deal.statusName === '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏'"
            (click)="cancelDeal(deal.id)" class="btn cancel">
            ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å —Å–¥–µ–ª–∫—É
          </button>

          <button 
            *ngIf="isAssociatedWithDeal(deal) && deal.statusName === '–û–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞' && deal.buyOrder.userLogin === user?.login"
            (click)="cancelDeal(deal.id)" class="btn cancel">
            ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π
          </button>

          <button 
            *ngIf="isAssociatedWithDeal(deal) && deal.statusName === '–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞' && deal.sellOrder.userLogin === user?.login"
            (click)="cancelDeal(deal.id)" class="btn cancel">
            ‚ö†Ô∏è –ü–µ—Ä–µ–≤–æ–¥ –Ω–µ –ø–æ–ª—É—á–µ–Ω
          </button>

          <button (click)="chatStart(deal)" class="btn chat">üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤ —á–∞—Ç</button>
        </div>
      </li>
    </ul>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="pagination">
      <button (click)="prevPage()" [disabled]="currentPage === 0" class="btn">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
      <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ currentPage + 1 }} –∏–∑ {{ totalPages }}</span>
      <button (click)="nextPage()" [disabled]="currentPage === totalPages - 1" class="btn">–í–ø–µ—Ä–µ–¥ ‚û°Ô∏è</button>
    </div>
  </div>

  <ng-template #noDeals>
    <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–¥–µ–ª–æ–∫.</p>
  </ng-template>
</div>
