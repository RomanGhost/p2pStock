<div class="requests-container">
  <h2>üìÑ –í–∞—à–∏ —Å–¥–µ–ª–∫–∏</h2>

  <!-- –§–∏–ª—å—Ç—Ä—ã -->
  <div class="filters">
    <label>
      –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ:
      <input type="date" [(ngModel)]="filters.changedAfter" (change)="applyFilters()" />
    </label>

    <label>
      –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:
      <select [(ngModel)]="filters.sortOrder" (change)="applyFilters()">
        <option value="asc">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
        <option value="desc">–ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
      </select>
    </label>
  </div>

  <div *ngIf="isLoading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

  <div *ngIf="!isLoading && deals.length > 0; else noDeals">
    <ul class="deal-list">
      <li *ngFor="let deal of deals" class="deal-item">
        <div class="deal-details">
          <strong>–°–¥–µ–ª–∫–∞ #{{ deal.id }}</strong>
          <p>–°—Ç–∞—Ç—É—Å: {{ deal.statusName }}</p>
          <p>–°–æ–∑–¥–∞–Ω–æ: {{ deal.createdAt | date: 'dd/MM/yyyy HH:mm' }}</p>
          <p>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: {{ deal.lastStatusChange | date: 'dd/MM/yyyy HH:mm' }}</p>
        </div>

        <div class="deal-actions">
          <button 
            *ngIf="isAssociatedWithDeal(deal) && deal.statusName === '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏' && wasCreatedEarlier(deal)"
            (click)="confirmDeal(deal.id)"
            class="btn confirm">
            ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–¥–µ–ª–∫—É
          </button>
          <button 
            *ngIf="isAssociatedWithDeal(deal) && deal.statusName === '–û–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞' && deal.buyOrder.userLogin === user?.login"
            (click)="confirmDeal(deal.id)"
            class="btn confirm">
            ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥
          </button>
          <button 
            *ngIf="isAssociatedWithDeal(deal) && deal.statusName === '–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞' && deal.sellOrder.userLogin === user?.login"
            (click)="confirmDeal(deal.id)"
            class="btn confirm">
            ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ
          </button>
          <button 
            *ngIf="isAssociatedWithDeal(deal) && deal.statusName === '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏'"
            (click)="cancelDeal(deal.id)"
            class="btn cancel">
            ‚ùå –û—Ç–º–µ–Ω–∞ —Å–¥–µ–ª–∫–∏
          </button>
          <button 
            *ngIf="isAssociatedWithDeal(deal) && deal.statusName === '–û–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞' && deal.buyOrder.userLogin === user?.login"
            (click)="cancelDeal(deal.id)"
            class="btn cancel">
            ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π
          </button>
          <button 
            *ngIf="isAssociatedWithDeal(deal) && deal.statusName === '–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞' && deal.sellOrder.userLogin === user?.login"
            (click)="cancelDeal(deal.id)"
            class="btn cancel">
            ‚ö†Ô∏è –ü–µ—Ä–µ–≤–æ–¥ –Ω–µ –ø–æ–ª—É—á–µ–Ω
          </button>
        </div>        
      </li>
    </ul>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º -->
    <div class="pagination">
      <button (click)="prevPage()" [disabled]="currentPage === 0" class="btn">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
      <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ currentPage + 1 }} –∏–∑ {{ totalPages }}</span>
      <button (click)="nextPage()" [disabled]="currentPage === totalPages - 1" class="btn">–í–ø–µ—Ä–µ–¥ ‚û°Ô∏è</button>
    </div>
  </div>

  <ng-template #noDeals>
    <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–¥–µ–ª–æ–∫.</p>
  </ng-template>
</div>
